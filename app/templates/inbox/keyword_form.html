{% extends "base.html" %}

{% set is_edit = rule is not none %}
{% set keyword_value = form_data.keyword if form_data else (rule.keyword if rule else '') %}
{% set response_value = form_data.response_body if form_data else (rule.response_body if rule else '') %}
{% set active_value = form_data.is_active if form_data else (rule.is_active if rule else True) %}

{% block title %}{{ 'Edit' if is_edit else 'Add' }} Keyword Rule - SMS Admin{% endblock %}

{% block page_title %}{{ 'Edit' if is_edit else 'Add' }} Keyword Rule{% endblock %}

{% block breadcrumbs %}
<a href="{{ url_for('main.dashboard') }}">Dashboard</a> / <a href="{{ url_for('main.keyword_rules_list') }}">Keyword Automations</a> / <span>{{ 'Edit' if is_edit else 'Add' }}</span>
{% endblock %}

{% block content %}
<div class="card app-card automation-form-card automation-form-card--keyword">
    <div class="card-body">
        <form method="POST" class="automation-form automation-form--keyword">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="mb-3">
                <label for="keyword" class="form-label">Keyword</label>
                <input type="text" class="form-control" id="keyword" name="keyword" value="{{ keyword_value }}"
                       maxlength="40" placeholder="e.g. HELP" required>
                <div class="form-text">Exact match, case-insensitive. Multi-word keywords are supported.</div>
            </div>

            <div class="mb-3">
                <label for="response_body" class="form-label">Auto-reply Message</label>
                <textarea class="form-control" id="response_body" name="response_body" rows="4" maxlength="1600"
                          placeholder="Enter the SMS reply..." required>{{ response_value }}</textarea>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if active_value %}checked{% endif %}>
                <label class="form-check-label" for="is_active">Active</label>
            </div>

            <div class="d-flex gap-2 automation-form__actions">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save me-1"></i>Save
                </button>
                <a href="{{ url_for('main.keyword_rules_list') }}" class="btn btn-outline-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
